---
title: 进程与线程
date: 2017-07-04 23:33:48
tags: 
- 摘录
categories: 
- 操作系统
---

__目录__

<!-- toc -->
<!--more-->

# 1 进程

像hello这样的程序在现代操作系统上运行时，操作系统会提供一种假象，就像系统上只有这个程序在运行，程序看上去独占使用__处理器、主存和I/O设备__。处理器看上去像不间断地一条接一条地执行程序中的命令，即该程序代码和数据是系统内存中唯一的对象。这些假象是通过进程的概念来实现的，进程是计算机科学中最重要和最成功的的概念之一

进程是操作系统对一个正在运行的程序的一种抽象，在一个系统上可以同时运行多个进程，而每个进程都好像独占地使用硬件。而并发运行，则是说一个进程的指令和另一个进程的指令是交错执行的。在大多数系统中，需要运行的进程是多于可以运行它们的CPU个数的

传统系统在一个时刻只能执行一个程序，而先进的多核处理器同时能够执行多个程序。无论在单核还是多核系统中，一个CPU看上去都像是在并发地执行多个进程，这是通过处理器在进程间切换来实现的。__操作系统实现这种交错执行的机制称为上下文切换__

操作系统保持跟踪进程运行所需的所有状态信息。__这种状态，就是上下文，包括许多信息，比如PC和寄存器文件的当前值，以及主存的内容__。当操作系统决定要把控制权从当前进程转移到某个新进程时，就会进行上下文切换，即保存当前进程的上下文、恢复进程的上下文，然后将控制权传递到新进程，新进程就会从它上次停止的地方开始

从一个进程到另一个进程的转换时由操作系统内核(kernel)管理的，内核是操作系统代码常驻主存的部分。当应用程序需要操作系统的某些操作时，比如读文件，它就执行一条特殊的系统调用(system call)指令，将控制权传递给内核，然后内核执行被请求的操作并返回给应用程序。

注意，内核不是一个独立的进程，相反，它是系统管理全部进程所用代码和数据结构的集合

![进程](/images/进程与线程/进程.png)

## 1.1 进程之间通信

以下为8种进程间通信方式，IPC(Inter-Process Communication)

1. __无名管道(pipe)__：管道是一种半双工的通信方式，数据只能单向流动，而且只能在具有亲缘关系的进程间使用。进程的亲缘关系通常是指父子进程关系。
1. __高级管道(popen)__：将另一个程序当做一个新的进程在当前程序进程中启动，则它算是当前程序的子进程，这种方式我们成为高级管道方式。
1. __有名管道(named pipe)__：有名管道也是半双工的通信方式，但是它允许无亲缘关系进程间的通信。
1. __消息队列(message queue)__：消息队列是由消息组成的链表，存放在内核中并由消息队列标识符标识。消息队列克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点。
1. __信号量(semophore)__：信号量是一个计数器，可以用来控制多个进程对共享资源的访问。它常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段。
1. __信号(sinal)__：信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生。
1. __共享内存(shared memory)__：共享内存就是映射一段能被其他进程所访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问。共享内存是最快的IPC方式，它是针对其他进程间通信方式运行效率低而专门设计的。它往往与其他通信机制，如信号量，配合使用，来实现进程间的同步和通信。
1. __套接字(socket)__：套接字也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同机器间的进程通信。

# 2 线程

通常我们认为一个进程只有单一的控制流，但在现代系统中，一个进程实际上可以由多个称为线程的执行单元组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据。

__由于网络服务器中对并行处理的需求，线程成为越来越重要的编程模型，因为多线程之间比多进程之间更容易共享数据(进程间也能共享数据)，也因为线程一般来说比进程更高效__

下图是Java中线程的状态转移图

![线程](/images/进程与线程/线程状态.png)

# 3 多进程与多线程

__进程__：每个进程都有独立的代码和数据空间（进程上下文），进程间的切换会有较大的开销，一个进程包含1--n个线程。__（进程是资源分配的最⼩小单位）__

__线程__：同一类线程共享代码和数据空间，每个线程有独立的运行栈和程序计数器(PC)，线程切换开销⼩小。__（线程是cpu调度的最⼩小单位）__

多进程是指操作系统能同时运行多个任务（程序）。多线程是指在同一程序中有多个顺序流在执行。

__多线程与多进程的区别__：本质的区别在于每个线程拥有自己的一套变量，⽽多线程则共享变量。其次，线程可能⽐进程显得更加“轻量级”，因为创建、撤销⼀个线程都比启动一个新进程的开销要小得多。另外，共享数据的特点使得线程与线程之间的通信变得更加容易与高效。但是，多线程的风险高得多。
