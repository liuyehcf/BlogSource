---
title: 操作系统原理-处理器调度
date: 2017-09-25 15:23:11
tags: 
- 摘录
categories: 
- 操作系统
- 操作系统原理
---

__目录__

<!-- toc -->
<!--more-->

# 1 CPU调度相关概念

## 1.1 CPU调度

CPU调度——其任务是控制、协调进程对CPU的竞争

* 即按一定的调度算法从就绪队列中选择一个进程，把CPU的使用权交给被选中的进程
* 如果没有就绪进程，系统会安排一个系统空闲进程或idle进程

## 1.2 CPU调度要解决的三个问题

WHAT：按什么原则选择下一个要执行的进程

* 调度算法

WHEN：何时选择

* 调度时机

HOW：如何让被选中的进程上CPU运行

* 调度过程（进程的上下文切换）

## 1.3 CPU调度的时机

事件发生 → 当前运行的进程暂停运行 → 硬件机制响应后 → 进入操作系统，处理相应的事件 → 结束处理后：__某些进程的状态会发生变化，也可能又创建了一些新的进程__
→ 就绪队列有调整 → 需要进程调度根据预设的调度算法从就绪队列选一个进程

典型的事件举例：

* 创建、唤醒、退出等进程控制操作
* 进程等待I/O、I/O中断
* 时钟中断，如：时间片用完、计时器到时
* 进程执行过程中出现abort异常

__CPU调度可能发生在以下几个时刻__

* 进程正常终止或由于某种错误而终止
* 新进程创建或一个等待进程变成就绪
* 当一个进程从运行态进入阻塞态
* 当一个进程从运行态变为就绪态
* __其本质是：内核对中断/异常/系统调用处理后返回到用户态时__

## 1.4 调度过程--进程切换

__进程调度程序从就绪队列选择了要运行的进程：这个进程可以是刚刚被暂停执行的进程，也可能是另一个新的进程。__

__进程切换：是指一个进程让出处理器，由另一个进程占用处理器的过程__

__进程切换主要包括两部分工作：__

* 切换全局页目录以加载一个新的地址空间
* 切换__内核栈和硬件上下文__，其中硬件上下文包括了内核执行新进程需要的全部信息，如CPU相关寄存器

切换过程包括了对原来运行进程各种状态的保存和对新的进程各种状态的恢复

__上下文切换的具体步骤（进程A下CPU，进程B上CPU）__

1. 保存进程A的上下文环境（程序计数器、程序状态字、其他寄存器...）
1. 用新状态和其他相关信息更新进程A的PCB
1. 把进程A移至合适的队列（就绪、阻塞...）
1. 将进程B的状态设置为运行态
1. 从进程B的PCB中恢复上下文（程序计数器、程序状态字、其他寄存器...）

__上下文切换的开销__

* __直接开销：内核完成切换所用的CPU时间__
    * 保存和恢复寄存器
    * 切换地址空间（相关指令比较昂贵）
* __间接开销：缓存失效__
    * 高速缓存(Cache)、缓冲区缓存(Buffer Cache)和TLB(Translation Look-aside Buffer)失效

## 1.5 CPU调度算法的设计

![fig1](/images/操作系统原理-处理器调度/fig1.jpg)

__调度算法衡量指标__

* 吞吐量Throughput：每单位时间完成的进程数目
* 周转时间TT(Turnaround Time)：每个进程从提出请求到运行完成的时间
* 响应时间RT(Response Time)：从提出请求到第一次回应的时间
* CPU 利用率(CPU Utilization)：CPU做有效工作的时间比例
* 等待时间(Waiting time)：每个进程在就绪队列(ready queue)中等待的时间

# 2 参考

__本篇博客摘录、整理自以下博文。若存在版权侵犯，请及时联系博主(邮箱：liuyehcf@163.com)，博主将在第一时间删除__

* 《MOOC-操作系统原理-陈向群》
