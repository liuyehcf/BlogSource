---
title: 操作系统原理-进程线程模型
date: 2017-09-25 15:23:02
tags: 
- 摘录
categories: 
- 操作系统
- 操作系统原理
---

__目录__

<!-- toc -->
<!--more-->

# 1 进程基本概念

## 1.1 为什么引入进程

__多道程序设计__：允许多个程序同时进入内存并运行，其目的是为了提高系统效率

__并发环境__：一段时间间隔内，单处理器上有两个或两个以上的程序同时处于开始运行但尚未结束的状态，并且次序不是事先确定的

![fig1](/images/操作系统原理-进程线程模型/fig1.jpg)

## 1.2 进程的定义

进程是具有独立功能的程序关于某个数据集合上的一次运行活动，是系统__进行资源分配和调度__的独立单位

* 程序的一次执行过程
* 是正在运行程序的抽象
* 将一个CPU变幻成多个虚拟的CPU
* 系统资源以进程为单位分配，如内存、文件、每个具有独立的地址空间...
* 操作系统将CPU调度给需要的进程

## 1.3 进程控制块PCB

PCB：Process Control Block

* 又称进程描述符、进程属性
* 操作系统用于管理控制进程的一个专门数据结构
* 记录进程的各种属性，描述进程的动态变化过程

__PCB是系统感知进程存在的唯一标志__

* 进程与PCB是一一对应的

__进程表：所有进程的PCB集合__

__PCB大致上包含以下四类信息__

1. __进程描述信息__
    * 进程标识符(process ID)，唯一，通常是一个整数
    * 进程名，通常基于可执行文件名，不唯一
    * 用户标识符(user ID)
    * 进程组关系
1. __进程控制信息__
    * 当前状态
    * 优先级(priority)
    * 代码执行入口地址
    * 程序的磁盘地址
    * 运行统计信息(执行时间、页面调度)
    * 进程间同步和通信
    * 进程的队列指针
    * 进程的消息队列指针
1. __所拥有的资源控制情况__
    * 虚拟地址空间的状况
    * 打开文件列表
1. __CPU现场__
    * 寄存器值(通用寄存器、程序计数器PC、程序状态字PSW、栈指针)
    * 指向该进程页表的指针

# 2 进程状态及状态转换

## 2.1 进程的三种基本状态

进程的三种基本状态：

* __运行态（Running）__：占有CPU，并在CPU上运行
* __就绪态（Ready）__：已经具备运行条件，但由于没有空闲CPU，而暂时不能运行
* __等待态（Waiting/Blocked）__：因等待某一事件而暂时不能运行

__三状态进程模型__的进程状态转移图如下

![fig2](/images/操作系统原理-进程线程模型/fig2.jpg)

## 2.2 进程的其他状态

进程的三种其他状态：

* __创建态（New）__：
    * 已完成创建一进程所必要的工作，例如创建PID、PCB
    * 但尚未同意执行该进程，因为资源有限
* __终止态（Terminate）__：
    * 终止执行后，进程进入该状态
    * 可完成一些数据统计工作
    * 资源回收
* __挂起态（Suspend）__：
    * 用于调节负载
    * 进程不占用内存空间，其进程映像交换到磁盘上

__五状态进程模型__的进程状态转移图如下

![fig3](/images/操作系统原理-进程线程模型/fig3.jpg)

__七状态进程模型__的进程状态转移图如下

![fig4](/images/操作系统原理-进程线程模型/fig4.jpg)

## 2.3 进程队列

操作系统为每一类进程建立一个或多个队列

* 队列元素为PCB
* 伴随进程状态的改变，其PCB从一个队列进入另一个队列

![fig5](/images/操作系统原理-进程线程模型/fig5.jpg)

__五状态进程模型__的队列模型如下

![fig6](/images/操作系统原理-进程线程模型/fig6.jpg)

# 3 进程控制

进程控制操作完成进程各状态之间的转换，由具有特定功能的__原语__完成

* 进程创建原语
* 进程撤消原语
* 阻塞原语
* 唤醒原语
* 挂起原语
* 激活原语
* 改变进程优先级

__什么是原语：完成某种特定功能的一段程序，具有不可分割性或不可中断性。即原语的执行必须是连续的，在执行过程中不允许被中断。也就是满足原子性__

## 3.1 进程的创建

进程创建包含如下操作

* 给新进程分配一个唯一标识以及进程控制块
* 为进程分配地址空间
* 初始化进程控制块。设置默认值 (如: 状态为 New，...)
* 设置相应的队列指针。如：把新进程加到就绪队列链表中

UNIX：fork/exec
WINDOWS：CreateProcess

## 3.2 进程的撤销

结束进程包含如下操作

* 收回进程所占有的资源
* 关闭打开的文件、断开网络连接、回收分配的内存...
* 撤消该进程的PCB

UNIX：exit
WINDOWS：TerminateProcess

## 3.3 进程阻塞

处于运行状态的进程，在其运行过程中期待某一事件发生，如等待键盘输入、等待磁盘数据传输完成、等待其它进程发送消息，当被等待的事件未发生时，由进程自己执行阻塞原语，使自己由运行态变为阻塞态

UNIX：wait
WINDOWS：WaitForSingleObject

## 3.4 Unix的几个进程控制操作

fork()：通过复制调用进程来建立新的进程，是最基本的进程建立过程
exec()：包括一系列系统调用，它们都是通过用一段新的程序代码覆盖原来的地址空间，实现进程执行代码的转换
wait()：提供初级进程同步操作，能使一个进程等待另外一个进程的结束
exit()：用来终止一个进程的运行

# 4 参考

__本篇博客摘录、整理自以下博文。若存在版权侵犯，请及时联系博主(邮箱：liuyehcf@163.com)，博主将在第一时间删除__

* 《MOOC-操作系统原理-陈向群》
