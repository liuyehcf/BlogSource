---
title: 寄存器
date: 2017-08-21 20:01:38
tags: 
- 摘录
categories: 
- 操作系统
- 基本概念
---

__目录__

<!-- toc -->
<!--more-->

# 1 寄存器定义

寄存器是中央处理器内的组成部份。寄存器是有限存贮容量的高速存贮部件，它们可用来暂存指令、数据和位址。在中央处理器的控制部件中，包含的寄存器有__指令寄存器(IR)和程序计数器(PC)。__在中央处理器的算术及逻辑部件中，包含的寄存器有累加器(ACC)。

寄存器是内存阶层中的最顶端，也是系统获得操作资料的最快速途径。寄存器通常都是以他们可以保存的位元数量来估量，举例来说，一个"8位元寄存器"或"32位元寄存器"。寄存器现在都以寄存器档案的方式来实作，但是他们也可能使用单独的正反器、高速的核心内存、薄膜内存以及在数种机器上的其他方式来实作出来。

寄存器通常都用来意指由一个指令之输出或输入可以直接索引到的暂存器群组。更适当的是称他们为"架构寄存器"。例如，x86指令及定义八个32位元寄存器的集合，但一个实作x86指令集的CPU可以包含比八个更多的寄存器。

寄存器是CPU内部的元件，寄存器拥有非常高的读写速度，所以在寄存器之间的数据传送非常快。

# 2 寄存器用途

1. 可将寄存器内的数据执行算术及逻辑运算
1. 存于寄存器内的地址可用来指向内存的某个位置，即寻址
1. 可以用来读写数据到电脑的周边设备。

# 3 寄存器的种类

__32位CPU所含有的寄存器有：__

1. 4个数据寄存器(EAX、EBX、ECX和EDX)
1. 2个变址和指针寄存器(ESI和EDI)，2个指针寄存器(ESP和EBP)
1. 6个段寄存器(ES、CS、SS、DS、FS和GS)
1. 个指令指针寄存器(EIP)，1个标志寄存器(EFlags)

## 3.1 数据寄存器

数据寄存器主要用来保存操作数和运算结果等信息，从而节省读取操作数所需占用总线和访问存储器的时间。32位CPU有4个32位的通用寄存器EAX、EBX、ECX和EDX，对低16位数据的存取，不会影响高16位的数据。这些低16位寄存器分别命名为：AX、BX、CX和DX，它和先前的CPU中的寄存器相一致。4个16位寄存器又可分割成8个独立的8位寄存器(AX：AH-AL、BX：BH-BL、CX：CH-CL、DX：DH-DL)，每个寄存器都有自己的名称，可独立存取。

程序员可利用数据寄存器的这种"可分可合"的特性，灵活地处理字/字节的信息。

下面分别说明一下EAX、EBX、ECX和EDX的使用场景

1. 寄存器EAX通常称为累加器(Accumulator)，用累加器进行的操作可能需要更少时间。可用于乘、除、输入/输出等操作，使用频率很高；
1. 寄存器EBX称为基地址寄存器(Base Register)。它可作为存储器指针来使用；
1. 寄存器ECX称为计数寄存器(Count Register)。在循环和字符串操作时，要用它来控制循环次数；在位操作中，当移多位时，要用CL来指明移位的位数；
1. 寄存器EDX称为数据寄存器(Data Register)。在进行乘、除运算时，它可作为默认的操作数参与运算，也可用于存放I/O的端口地址。

在16位CPU中，AX、BX、CX和DX不能作为基址和变址寄存器来存放存储单元的地址，在32位CPU中，其32位寄存器EAX、EBX、ECX和EDX不仅可传送数据、暂存数据保存算术逻辑运算结果，而且也可作为指针寄存器，所以，这些32位寄存器更具有通用性。

## 3.2 变址寄存器

32位CPU有2个32位通用寄存器ESI和EDI。其低16位对应先前CPU中的SI和DI，对低16位数据的存取，不影响高16位的数据。寄存器ESI、EDI、SI和DI称为变址寄存器(Index Register)，它们主要用于存放存储单元在段内的偏移量，用它们可实现多种存储器操作数的寻址方式，为以不同的地址形式访问存储单元提供方便。变址寄存器不可分割成8位寄存器。作为通用寄存器，也可存储算术逻辑运算的操作数和运算结果。它们可作一般的存储器指针使用。在字符串操作指令的执行过程中，对它们有特定的要求，而且还具有特殊的功能。

## 3.3 指针寄存器

寄存器EBP、ESP、BP和SP称为指针寄存器(Pointer Register)，主要用于存放堆栈内存储单元的偏移量，用它们可实现多种存储器操作数的寻址方式，为以不同的地址形式访问存储单元提供方便。指针寄存器不可分割成8位寄存器。作为通用寄存器，也可存储算术逻辑运算的操作数和运算结果。

32位CPU有2个32位通用寄存器EBP和ESP。它们主要用于访问堆栈内的存储单元，并且规定：

* EBP为基指针(Base Pointer)寄存器，用它可直接存取堆栈中的数据；
* ESP为堆栈指针(Stack Pointer)寄存器，用它只可访问栈顶。

## 3.4 段寄存器

段寄存器是根据内存分段的管理模式而设置的。内存单元的物理地址由段寄存器的值和一个偏移量组合而成的，这样可用两个较少位数的值组合成一个可访问较大物理空间的内存地址。

__CPU内部的段寄存器：__

1. ECS——代码段寄存器(Code Segment Register)，其值为代码段的段值；
1. EDS——数据段寄存器(Data Segment Register)，其值为数据段的段值；
1. EES——附加段寄存器(Extra Segment Register)，其值为附加数据段的段值；
1. ESS——堆栈段寄存器(Stack Segment Register)，其值为堆栈段的段值；
1. EFS——附加段寄存器(Extra Segment Register)，其值为附加数据段的段值；
1. EGS——附加段寄存器(Extra Segment Register)，其值为附加数据段的段值。

## 3.5 指令指针寄存器

32位CPU把指令指针扩展到32位，并记作EIP，EIP的低16位与先前CPU中的IP作用相同。

指令指针EIP、IP(Instruction Pointer)是存放下次将要执行的指令在代码段的偏移量。在具有预取指令功能的系统中，下次要执行的指令通常已被预取到指令队列中，除非发生转移情况。

__在x86体系里是这样。x86系统中自增的是IP，用CS:IP组合表示正在执行的指令地址，此时PC（程序计数器）只是一个概念上的说法。__

## 3.6 运算结果标志位

1. 进位标志CF(Carry Flag)：
    * 进位标志CF主要用来反映运算是否产生进位或借位。如果运算结果的最高位产生了一个进位或借位，那么，其值为1，否则其值为0。
    * 使用该标志位的情况有：多字(字节)数的加减运算，无符号数的大小比较运算，移位操作，字(字节)之间移位，专门改变CF值的指令等。
1. 奇偶标志PF(Parity Flag)
    * 奇偶标志PF用于反映运算结果中"1"的个数的奇偶性。如果"1"的个数为偶数，则PF的值为1，否则其值为0。
    * 利用PF可进行奇偶校验检查，或产生奇偶校验位。在数据传送过程中，为了提供传送的可靠性，如果采用奇偶校验的方法，就可使用该标志位。
1. 辅助进位标志AF(Auxiliary Carry Flag)
    * 在发生下列情况时，辅助进位标志AF的值被置为1，否则其值为0：
        * 在字操作时，发生低字节向高字节进位或借位时；
        * 在字节操作时，发生低4位向高4位进位或借位时。
1. 零标志ZF(Zero Flag)
    * 零标志ZF用来反映运算结果是否为0。如果运算结果为0，则其值为1，否则其值为0。在判断运算结果是否为0时，可使用此标志位。
1. 符号标志SF(Sign Flag)
    * 符号标志SF用来反映运算结果的符号位，它与运算结果的最高位相同。在微机系统中，有符号数采用码表示法，所以，SF也就反映运算结果的正负号。运算结果为正数时，SF的值为0，否则其值为1。
1. 溢出标志OF(Overflow Flag)
    * 溢出标志OF用于反映有符号数加减运算所得结果是否溢出。如果运算结果超过当前运算位数所能表示的范围，则称为溢出，OF的值被置为1，否则，OF的值被清为0。

## 3.7 状态控制标志位
 
状态控制标志位是用来控制CPU操作的，它们要通过专门的指令才能使之发生改变。

1. 追踪标志TF(Trap Flag)
    * 当追踪标志TF被置为1时，CPU进入单步执行方式，即每执行一条指令，产生一个单步中断请求。这种方式主要用于程序的调试。
    8 指令系统中没有专门的指令来改变标志位TF的值，但程序员可用其它办法来改变其值。

1. 中断允许标志IF(Interrupt-enable Flag)
    * 中断允许标志IF是用来决定CPU是否响应CPU外部的可屏蔽中断发出的中断请求。
    * 但不管该标志为何值，CPU都必须响应CPU外部的不可屏蔽中断所发出的中断请求，以及CPU内部产生的中断请求。
    * 具体规定如下：
        * 当IF=1时，CPU可以响应CPU外部的可屏蔽中断发出的中断请求；
        * 当IF=0时，CPU不响应CPU外部的可屏蔽中断发出的中断请求。
    * CPU的指令系统中也有专门的指令来改变标志位IF的值。
1. 方向标志DF(Direction Flag)
    * 方向标志DF用来决定在串操作指令执行时有关指针寄存器发生调整的方向。
    * 在微机的指令系统中，还提供了专门的指令来改变标志位DF的值。

## 3.8 32位标志寄存器增加的标志位

1. I/O特权标志IOPL(I/O Privilege Level)
    * I/O特权标志用两位二进制位来表示，也称为I/O特权级字段。该字段指定了要求执行I/O指令的特权级。
    * 如果当前的特权级别在数值上小于等于IOPL的值，那么，该I/O指令可执行，否则将发生一个保护异常。
1. 嵌套任务标志NT(Nested Task)
    * 嵌套任务标志NT用来控制中断返回指令IRET的执行。具体规定如下：
        * 当NT=0，用堆栈中保存的值恢复EFLAGS、CS和EIP，执行常规的中断返回操作；
        * 当NT=1，通过任务转换实现中断返回。
1. 重启动标志RF(Restart Flag)
    * 重启动标志RF用来控制是否接受调试故障。规定：RF=0时，表示“接受”调试故障，否则拒绝之。
    * 在成功执行完一条指令后，处理机把RF置为0，当接受到一个非调试故障时，处理机就把它置为1。
1. 虚拟8086方式标志VM(Virtual 8086 Mode)
    * 如果该标志的值为1，则表示处理机处于虚拟的8086方式下的工作状态，否则，处理机处于一般保护方式下的工作状态。

# 4 参数

* [汇编中各寄存器的作用](http://blog.csdn.net/ly131420/article/details/8741225)
* [【汇编】各种寄存器介绍](http://www.cnblogs.com/wisehead/articles/3819233.html)
* [程序计数器（Program Counter）是一个实际存在的寄存器吗?](https://www.zhihu.com/question/22609253)
* [ 指令寄存器和程序计数器的区别](http://blog.csdn.net/legend_x/article/details/19619327)
