---
title: 计算机体系结构
date: 2021-11-16 09:19:25
tags: 
- 摘录
categories: 
- System Architecture
---

**阅读更多**

<!--more-->

# 1 概述

## 1.1 引言

**系统和系统架构：**

1. **系统是为实现一个或多个所声明的目标而组织的相互关联的要素的组合**
1. **系统架构是系统组件的组织结构、它们之间的关系、与环境的关系、以及指导其设计和进化的原则**

**体系结构的定义：**

1. **设计、选择和连接硬件组件以及设计硬件/软件接口，以创建一个满足功能、性能、能耗、成本和其他具体目标的计算系统的科学和艺术**
1. **体现为描述计算机系统的功能、结构组织和实现的一组规则和方法**
* **广义：计算机体系结构指计算机（硬件）系统的抽象表示，基于这些抽象表示使得我们可以更好地使用可用的制造技术实现（信息处理）硬件系统，高效地设计与实现（信息处理）软件系统**

**计算机体系结构研究范畴：**

* **早期定义（Amdahl, Blaauw, and Brooks, 1964）：程序员可见的计算系统的属性。包括：概念性的结构和功能行为。不包括：数据流和控制流的组织、逻辑设计以及物理实现**
* **狭义：计算机体系结构是软件设计者与硬件设备设计者（VLSI）之间的中间层（ISA），以及微体系结构**
* **扩展的观点：计算机体系结构包括：算法层、程序/语言层、系统软件层、ISA层、微体系结构、逻辑电路层、以及器件层**

**计算机组成与实现：**

* **计算机组成（Computer Organization or Microarchitecture)：ISA的逻辑实现。包括，物理机器级中的数据流和控制流的组成以及逻辑设计等**
* **计算机实现（Computer Implementation)：计算机组成的物理实现。包括，`CPU`，`MEMORY`等的物理结构，器件的集成度、速度，模块、插件、底板的划分与连接、信号传输、电源、冷却及整机装配技术等**

## 1.2 量化设计与分析基础

**管理复杂性：**

* 将工程师或计算机科学家与门外汉区分开来的特征之一是管理复杂性的系统方法
* 现代数字系统是由数百万甚至数十亿个晶体管组成的。没有人能够通过写出描述每个晶体管中电子运动的方程并同时解出所有方程来理解这些系统
* **管理复杂性的方法：抽象 (Abstraction)+ 原则 (Discipline)+ 3'Y**

**影响体系结构技术发展的主要因素：**

* 产品应用方面：`PC/Server => IoT, Mobile/Cloud`
* 集成电路技术方面：
    * 登纳德缩放比例定律的终结：功耗成为关键制约条件
    * Moore定律的终结：晶体管的集成度提高延缓
* 体系结构方面
    * 挖掘指令级并行性方面的限制和低效，04年结束了单处理器时代
    * Amdahl定律暗示了简单多核时代的结束

## 1.3 定量分析基础

**过去数十年间，计算机系统设计方面的巨大变化**

* 在过去的50年，`Moore's law`和`Dennard scaling`(登纳德缩放比例定律)主宰着芯片产业的发展
    * `Moore`在1965年预测：晶体管数量随着尺寸缩小按接近平方关系增长（每18个月翻倍）
    * `Dennard`在1974年预测：晶体管尺寸变小，功耗会同比变小（相同面积下功耗不变）
    * 工艺技术的进步可在不改变软件模型的情况下，持续地提高系统性能/能耗比
* 最近10年间，工艺技术的发展受到了很大制约
    * Dennard scaling over (supply voltage ~fixed)
    * Moore's Law (cost/transistor) over?
    * Energy efficiency constrains everything
* 功耗问题成为系统结构设计必须考虑的问题
* 软件设计者必须考虑
    * Parallel systems
    * Heterogeneous systems

**有关体系结构的新旧观念**

* **旧观念：**
    * 能源很便宜，晶体管很贵
    * 通过编译、体系结构创新来增加指令级并行
    * 乘法器速度较慢，访存速度比较快
    * 单处理器性能，每1.5年翻倍
* **新观念：**
    * 能源很贵，晶体管很便宜
    * 挖掘指令级并行的收益越来越小
    * 乘法器速度提升了，访存成为瓶颈
    * `Power Wall + ILP Wall + Memory Wall = Brick Wall`，单处理器性能，每5年翻倍
    * 每2年，单个芯片上的处理器数量翻倍

**性能：**

* 性能度量
    * 响应时间
    * 吞吐率
* CPU执行时间=`IC * CPI * T`
    * `CPI`指的是`Cycles per Instruction`
* `Latency`与`Bandwidth`
    * `Latency`指单个任务的执行时间，`Bandwidth`指单位时间完成的任务量（rate）
    * `Latency`的提升滞后于带宽的提升 (在过去的30年）
* `Amdahl's Law`用来度量加速比
    * 性能提升受限于任务中可加速部分所占的比例
    * 应用于多处理器系统的基本假设：在给定的问题规模下，随着处理器数目的增加性能的变化
* `Benchmarks`：指一组用于测试的程序
    * 比较计算机系统的性能 （算术平均、调和平均、几何平均）

## 1.4 相关课件

* [Chapter-1.1](/Papers/System-Architecture/1-1.pdf)
* [Chapter-1.2](/Papers/System-Architecture/1-2.pdf)
* [Chapter-1.3](/Papers/System-Architecture/1-3.pdf)

# 2 ISA

## 2.1 ISA的基本概念

**什么是指令集架构？**

* 软件子系统与硬件子系统的关键界面
* 一组直接由硬件执行的指令，包括
    * 程序员可见的机器状态
    * 程序员可见的指令集合（操作机器状态的指令）
* 应具备的特征（七个衡量指标）
    1. 成本
    1. 简洁性
    1. 架构和具体实现分离：可持续多代，以保持向后兼容
    1. 可扩展空间：可用于不同应用领域（desktops、servers、embedded applications）
    1. 程序大小：所生成的代码占用空间小
    1. 易于编程/编译/链接：为高层软件的实现与开发提供方便的功能
    1. 性能：方便低层硬件子系统高效实现

**重要的系统界面（System Interface）：**

* `ISA`界面
* `ABI`界面

**`ISA`：用户级`ISA`+特权级`ISA`**

* 用户级ISA适用于操作系统和应用程序
* 特权级ISA适用于硬件资源的管理（操作系统）

**ISA必须说明哪些东西？**

* 指令格式
* 存储器寻址
* 操作数的类型和大小
* 所支持的操作
* 控制转移类指令

**尾端问题：在一个字内部的字节顺序问题，以int（`0x12345678`）为例**

* `Little Endian`：高位在前，但是每个字节内部的`bit`还是按原来的顺序存放，即`0x78->0x56->0x34->0x12`
* `Big Endian`：低位在前，即`0x12->0x34->0x56->0x78`

**寻址方式：**

| Model | Example | Meaning | When used |
|:--|:--|:--|:--|
| Register | `Add R1, R2` | `R1 ← R1 + R2` | 操作数在寄存器中 |
| Immediate | `Add R1, 100` | `R1 ← R1 + 100` | 立即数寻址，常量 |
| Register Indirect | `Add R1, (R2)` | `R1 ← R1 + Mem(R2)` | `R2`存储的是地址 |
| Displacement | `Add R1, (R2 + 16)` | `R1 ← R1 + Mem(R2 + 16)` | 访问局部变量 |
| Absolute | `Add R1, (1000)` | `R1 ← R1 + Mem(1000)` | 访问静态变量 |
| Indexed | `Add R1, (R2 + R3)` | `R1 ← R1 + Mem(R2 + R3)` | 偏移寻址，`R2 = base`、`R3 = index` |
| Scaled Index | `Add R1, (R2 + s * R3)` | `R1 ← R1 + Mem(R2 + s * R3)` | `s = scale factor(2,4,8)` |
| Post-increment | `Add R1, (R2)+` | `R1 ← R1 + Mem(R2)`</br>`R2 ← R2 + s` | 向后跳过`array`，其中`s = element size` |
| Pre-decrement | `Add R1, -(R2)` | `R2 ← R2 - s`</br>`R1 ← R1 + Mem(R2)` | 向前跳过`array`，其中`s = element size` |

**操作数的类型、表示和大小：**

* 操作数类型和操作数表示是软硬件的主要界面之一
* 操作数类型：是面向应用、面向软件系统所处理的各种数据类型
* 操作数的表示：操作数在机器中的表示，硬件结构能够识别，指令系统可以直接使用的表示格式

**控制类指令：**

1. 条件分支`Conditional Branch`
1. 跳转`Jump`
1. 过程调用`Procedure calls`
1. 过程返回`Procedure returns`

**指令格式选择策略**

* 如果代码规模最重要，那么使用变长指令格式
* 如果性能至关重要，使用固定长度指令
* 有些嵌入式CPU附加可选模式，由每一应用自己选择性能还是代码量

## 2.2 相关课件

* [Chapter-2.1](/Papers/System-Architecture/2-1.pdf)
* [Chapter-2.2](/Papers/System-Architecture/2-2.pdf)
* [Chapter-2.3](/Papers/System-Architecture/2-3.pdf)

# 3 基本流水线

## 3.1 相关课件

* [Chapter-3.1](/Papers/System-Architecture/3-1.pdf)
* [Chapter-3.2](/Papers/System-Architecture/3-2.pdf)

# 4 存储层次结构设计

## 4.1 相关课件

* [Chapter-4.1](/Papers/System-Architecture/4-1.pdf)
* [Chapter-4.2](/Papers/System-Architecture/4-2.pdf)
* [Chapter-4.3](/Papers/System-Architecture/4-3.pdf)
* [Chapter-4.4](/Papers/System-Architecture/4-4.pdf)

# 5 指令级并行

## 5.1 相关课件

* [Chapter-5.1](/Papers/System-Architecture/5-1.pdf)
* [Chapter-5.2](/Papers/System-Architecture/5-2.pdf)
* [Chapter-5.3](/Papers/System-Architecture/5-3.pdf)
* [Chapter-5.4](/Papers/System-Architecture/5-4.pdf)
* [Chapter-5.5](/Papers/System-Architecture/5-5.pdf)
* [Chapter-5.6](/Papers/System-Architecture/5-6.pdf)
* [Chapter-5.7](/Papers/System-Architecture/5-7.pdf)

# 6 数据级并行

## 6.1 相关课件

* [Chapter-6.1](/Papers/System-Architecture/6-1.pdf)
* [Chapter-6.2](/Papers/System-Architecture/6-2.pdf)
* [Chapter-6.3](/Papers/System-Architecture/6-3.pdf)
* [Chapter-6.4](/Papers/System-Architecture/6-4.pdf)

# 7 多处理器及线程级并行

## 7.1 相关课件

* [Chapter-7.1](/Papers/System-Architecture/7-1.pdf)
* [Chapter-7.2](/Papers/System-Architecture/7-2.pdf)
* [Chapter-7.3](/Papers/System-Architecture/7-3.pdf)

# 8 缩写表

| 缩写 | 全称 |
|:--|:--|
| `ISA` | `Instruction-Set Architecture` |
| `VLIW` | `Very Long Instruction Word` |
| `EPIC` | `Explicitly Parallel Instruction Computing` |
| `CISC` | `Complex Instruction Set Computer` |
| `RISC` | `Reduced Instruction Set Computer` |
| `CPI` | `Cycles per Instruction` |
| `MIPS` | `Millions of Instructions Per Second` |
| `ABI` | `Application Binary Interface` |

# 9 参考

* [计算机体系结构(Spring 2021)](http://staff.ustc.edu.cn/~xhzhou/CA-Spring2021/CA.html)
