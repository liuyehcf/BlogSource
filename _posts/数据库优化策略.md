---
title: 数据库优化策略
date: 2017-09-02 11:18:54
tags: 
- 摘录
categories: 
- 数据库
- 基本概念
---

__目录__

<!-- toc -->
<!--more-->

# 1 前言

__数据库优化的指导思路是首先写出的SQL是优化器喜欢的__，然后在排除烂的SQL的情况下就是，找瓶颈，数据库吞吐量上不去或者查询慢都是因为某一瓶颈的存在，__从非常大的粒度来看，瓶颈可以分为五类：io、内存、CPU、网络、锁__。当卡在某一瓶颈时，其他的资源就会被闲置，解决瓶颈或者用非瓶颈的资源做trade off达到总和的最大才是优化的正解，比如建索引就是以空间换时间的做法。__由于数据库相对比较复杂，上下文有区别优化思路也会不一样，所以离开上下文谈具体的优化手段就是坑。__大部分开发人员会犯的错误是所谓的"锤子人"，也就是自己是锤子看什么都像钉子，比如觉得慢就说要分区，觉得某种语句的写法一定比另一种快而不考虑场景。

# 2 调整数据结构的设计

这一部分在开发信息系统之前完成，程序员需要考虑是否使用ORACLE数据库的分区功能，对于经常访问的数据库表是否需要建立索引等

# 3 调整应用程序结构设计

这一部分也是在开发信息系统之前完成，程序员在这一步需要考虑应用程序使用什么样的体系结构，是使用传统的Client/Server两层体系结构，还是使用Browser/Web/Database的三层体系结构。不同的应用程序体系结构要求的数据库资源是不同的

# 4 调整数据库SQL语句

应用程序的执行最终将归结为数据库中的SQL语句执行，因此SQL语句的执行效率最终决定了ORACLE数据库的性能。ORACLE公司推荐使用ORACLE语句优化器（Oracle Optimizer）和行锁管理器（row-level manager）来调整优化SQL语句

# 5 调整服务器内存分配

内存分配是在信息系统运行过程中优化配置的，数据库管理员可以根据数据库运行状况调整数据库系统全局区（SGA区）的数据缓冲区、日志缓冲区和共享池的大小；还可以调整程序全局区（PGA区）的大小。需要注意的是，SGA区不是越大越好，SGA区过大会占用操作系统使用的内存而引起虚拟内存的页面交换，这样反而会降低系统

# 6 调整硬盘I/O

这一步是在信息系统开发之前完成的。数据库管理员可以将组成同一个表空间的数据文件放在不同的硬盘上，做到硬盘之间I/O负载均衡

# 7 调整操作系统参数

例如：运行在UNIX操作系统上的ORACLE数据库，可以调整UNIX数据缓冲池的大小，每个进程所能使用的内存大小等参数。

实际上，上述数据库优化措施之间是相互联系的。ORACLE数据库性能恶化表现基本上都是用户响应时间比较长，需要用户长时间的等待。但性能恶化的原因却是多种多样的，有时是多个因素共同造成了性能恶化的结果，这就需要数据库管理员有比较全面的计算机知识，能够敏感地察觉到影响数据库性能的主要原因所在。另外，良好的数据库管理工具对于优化数据库性能也是很重要的。

# 8 索引

索引是提高数据库性能的常用方法

创建索引时的注意事项

1. 表的主键、外键必须有索引
1. 数据量超过300的表应该有索引
1. 经常与其他表进行连接的表，在连接字段上应该建立索引
1. 经常出现在Where子句中的字段，特别是大表的字段，应该建立索引
1. 索引应该建在选择性高的字段上
1. 索引应该建在小字段上，对于大的文本字段甚至超长字段，不要建索引
    * 正确选择复合索引中的主列字段，一般是选择性较好的字段
    * 复合索引的几个字段是否经常同时以AND方式出现在Where子句中？单字段查询是否极少甚至没有？如果是，则可以建立复合索引；否则考虑单字段索引
    * 如果复合索引中包含的字段经常单独出现在Where子句中，则分解为多个单字段索引
    * 如果复合索引所包含的字段超过3个，那么仔细考虑其必要性，考虑减少复合的字段
    * 如果既有单字段索引，又有这几个字段上的复合索引，一般可以删除复合索引
1. 频繁进行数据操作的表，不要建立太多的索引
1. 删除无用的索引，避免对执行计划造成负面影响；
1. 复合索引的建立需要进行仔细分析，尽量考虑用单字段索引代替

# 9 分页优化

MySQL的LIMIT工作原理就是先读取n条记录，然后抛弃前n条，读m条想要的，所以n越大，性能会越差。

```
SELECT * FROM crm_user INNER JOIN (SELECT id FROM crm_user LIMIT 1000,10) AS a  USING(id);

SELECT * FROM crm_user INNER JOIN (SELECT id FROM crm_user LIMIT 1000,10) AS a  ON crm_user.id = a.id;
```

# 10 数据库分表

{% post_link 数据库分表策略 %}

# 11 尽量不使用NULL字段

MySQL难以优化引用可空列查询，它会使索引、索引统计和值更加复杂。可空列需要更多的存储空间，还需要MySQL内部进行特殊处理。可空列被索引后，每条记录都需要一个额外的字节，还能导致MyISAM中固定大小的索引变成可变大小的索引

# 12 参考

__本篇博客摘录、整理自以下博文。若存在版权侵犯，请及时联系博主(邮箱：liuyehcf@163.com)，博主将在第一时间删除__

* [MySQL的几种优化方法](http://blog.csdn.net/u013474436/article/details/49908683)
* [数据库性能优化有哪些措施?](https://zhidao.baidu.com/question/67759076.html)
* [有哪些常见的数据库优化方法？](https://www.zhihu.com/question/36431635?sort=created)
